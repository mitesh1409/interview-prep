# Coding Question

## Coding Question (Node.js Event Loop)

**Question:**
What will be the output of the following Node.js code and why?

```js
const fs = require('fs');

console.log('Start');

// --------------------
// Synchronous code
// --------------------
console.log('Sync Code');

// --------------------
// setImmediate (Check phase)
// --------------------
setImmediate(() => {
  console.log('setImmediate');
});

// --------------------
// setTimeout (Timers phase)
// --------------------
setTimeout(() => {
  console.log('setTimeout');
}, 0);

// --------------------
// setInterval (Timers phase)
// --------------------
const intervalId = setInterval(() => {
  console.log('setInterval');
  clearInterval(intervalId);
}, 0);

// --------------------
// I/O (Poll phase)
// --------------------
fs.readFile(__filename, () => {
  console.log('I/O - readFile');
});

// --------------------
// Promise (Microtask)
// --------------------
Promise.resolve().then(() => {
  console.log('Promise.then');
});

// --------------------
// process.nextTick
// --------------------
process.nextTick(() => {
  console.log('process.nextTick');
});

console.log('End');
```

---

## High-Level Execution Order

1. **Synchronous code**
2. **Microtasks**

   * `process.nextTick`
   * Promises
3. **Event Loop phases**

   1. Timers (`setTimeout`, `setInterval`)
   2. Poll (I/O callbacks)
   3. Check (`setImmediate`)

---

## Low-Level Step-by-Step Explanation

### 1. Synchronous Phase (Call Stack)

All synchronous statements execute immediately.

```text
Start
Sync Code
End
```

---

### 2. Microtask Queue (Runs before Event Loop phases)

Node.js drains the **microtask queues** immediately after synchronous code.

**Order inside microtasks:**

1. `process.nextTick`
2. Promise callbacks

```text
process.nextTick
Promise.then
```

> `process.nextTick` has **higher priority** than Promises in Node.js.

---

### 3. Event Loop Phases

#### a) **Timers Phase**

Executes callbacks scheduled by `setTimeout` and `setInterval`.

```text
setTimeout
setInterval
```

> `setInterval` runs once here because it is cleared inside the callback.

---

#### b) **Poll Phase (I/O callbacks)**

Executes completed I/O operations.

```text
I/O - readFile
```

---

#### c) **Check Phase**

Executes `setImmediate` callbacks.

```text
setImmediate
```

---

## Final Output (Correct Order)

```text
Start
Sync Code
End
process.nextTick
Promise.then
setTimeout
setInterval
I/O - readFile
setImmediate
```

---

## Important Interview Notes

* **Placement in code does NOT affect execution order**
* Microtasks always run **before** the event loop phases
* `process.nextTick` always runs **before Promises**
* `setImmediate` always runs **after the poll phase**
* `setTimeout(0)` does **not** mean “run immediately”
* I/O callbacks depend on OS completion but still respect event loop phases
