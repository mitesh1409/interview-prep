# CommonJS Module vs ECMAScript Module in Node.js

Node.js supports **two module systems** for organizing and sharing code:

1. **CommonJS (CJS)**
2. **ECMAScript Modules (ESM)**

---

## #1 CommonJS Module System (CJS)

CommonJS is the **original and default** module system in Node.js.

### Key Features

* Uses `require()` to import modules.
* Uses `module.exports` (or `exports`) to export values.
* Works synchronously during module loading.
* Widely used in older Node.js code and many existing packages.

### Syntax

```js
// Import
const fs = require('fs');

// Export
module.exports = function greet() {
  console.log('Hello');
};
```

### Important Notes

* Node.js treats files as **CommonJS by default**.
* Module loading is **blocking (synchronous)**, which is acceptable because it usually happens only once at startup.
* `require()` can be called conditionally or dynamically.

---

## #2 ECMAScript Module System (ESM)

ECMAScript Modules are the **official JavaScript standard** module system, supported by browsers and Node.js.

### Key Features

* Uses `import` and `export` keywords.
* Designed to be **static and predictable**.
* Aligns Node.js with modern JavaScript standards.

### Syntax

```js
// Import
import fs from 'fs';

// Export
export function greet() {
  console.log('Hello');
}
```

### Enabling ESM in Node.js

To use ESM, you must explicitly enable it.

#### Option 1: Use `"type": "module"` in `package.json`

```json
{
  "type": "module"
}
```

#### Option 2: Use `.mjs` file extension

```bash
index.mjs
```

### Important Notes

* **ESM itself is not asynchronous**, but:

  * Module loading and linking can be asynchronous internally.
* `import` statements are **hoisted** and evaluated before code execution.
* `import` must be at the **top level** (cannot be used conditionally).
* ESM supports **static analysis**, which helps with optimization and tooling.

---

## Key Differences at a Glance

| Feature             | CommonJS         | ECMAScript Modules                 |
| ------------------- | ---------------- | ---------------------------------- |
| Default in Node.js  | Yes              | No                                 |
| Import syntax       | `require()`      | `import`                           |
| Export syntax       | `module.exports` | `export`                           |
| Loading style       | Synchronous      | Static (internally async-friendly) |
| Conditional imports | Allowed          | Not allowed                        |
| Standardized        | No               | Yes (JavaScript standard)          |

---

## Summary

* **CommonJS** is simple, flexible, and still widely used in Node.js.
* **ESM** is the future-facing, standard module system shared with browsers.
* New Node.js projects are encouraged to use **ESM**, while legacy projects often remain on **CommonJS**.

---

## References

* [Modules: CommonJS Modules](https://nodejs.org/docs/latest/api/modules.html)
* [Modules: ECMAScript modules](https://nodejs.org/docs/latest/api/esm.html)
